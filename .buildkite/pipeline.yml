steps:
  - group: ":beats: Stack installers Snapshot"
    key: "dra-snapshot"
    steps:
    - label: ":hammer: Build stack installers Snapshot"
      command: ".buildkite/scripts/build.ps1"
      key: "build-snapshot"
      artifact_paths: "bin/out/**/*.msi"
      agents:
        provider: gcp
        image: family/ci-windows-2022
      env: 
        WORKFLOW: "snapshot"
    - label: ":package: DRA Publish Snapshot"
      command: ".buildkite/scripts/dra-publish.sh"
      key: "publish-snapshot"
      depends_on: "build-snapshot"
      agents:
        provider: gcp
      env: 
        WORKFLOW: "snapshot"
        # BRANCH: "${BUILDKITE_BRANCH}"
        BRANCH: "8.7"
  - group: ":beats: Stack installers Staging :beats:"
    key: "dra-staging"
    steps:
    - label: ":hammer: Build stack installers staging"
      # if: "build.branch =~ /^\\d\\d\\.\\d\\d$/ || build.pull_request.base_branch =~ /^\\d\\d\\.\\d\\d$/"
      command: ".buildkite/scripts/build.ps1"
      key: "build-staging"
      artifact_paths: "bin/out/**/*.msi"
      agents:
        provider: gcp
        image: family/ci-windows-2022
      env: 
        WORKFLOW: "staging"
    - label: ":package: DRA Publish staging"
      # if: "build.branch =~ /^\\d\\d\\.\\d\\d$/ || build.pull_request.base_branch =~ /^\\d\\d\\.\\d\\d$/"
      command: ".buildkite/scripts/dra-publish.sh"
      key: "publish-staging"
      depends_on: "build-staging"
      agents:
        provider: gcp
      env: 
        WORKFLOW: "staging"
        # BRANCH: "${BUILDKITE_BRANCH}"
        BRANCH: "8.7"
# notify:
#   - slack: "#release-eng-alerts"
#     if: 'build.pull_request.id == null && build.state != "passed"'